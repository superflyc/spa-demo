//v2.0.0 - C 2013, Dave Herren, License: MIT 
ko.viewmodel=function(){function m(b){return null===b||void 0===b}function v(b){return null===b||void 0===b||b.constructor===String||b.constructor===Number||b.constructor===Boolean||b instanceof Date}function n(b,f,d){var a,c,e,g,l,j,h=f?f[d.full]||f[d.parent]||f[d.name]||{}:{};k&&k(d,h,f);k&&k(d);if(a=h.custom)j=!0,"function"===typeof a?c=a(b):(c=a.map(b),m(c)||(c.___$mapCustom=a.map,a.unmap&&(c.___$unmapCustom=a.unmap)));else if(h.append)j=!0,m(b)||(b.___$appended=void 0),c=b;else{if(h.exclude)return j=
!0,q;if(v(b))c=d.parentIsArray?b:x(b);else if(b instanceof Array){c=[];e=0;for(a=b.length;e<a;e++)c[e]=n(b[e],f,{name:"[i]",parent:d.name+"[i]",full:d.full+"[i]",parentIsArray:!0});if(!d.parentIsArray||w){g={name:"[i]",parent:d.name+"[i]",full:d.full+"[i]",parentIsArray:!0};c=y(c);if(b=h.arrayChildId)c.___$childIdName=b;c.pushFromModel=function(a){a=n(a,f,g);c.push(a)};c.unshiftFromModel=function(a){a=n(a,f,g);c.unshift(a)};c.popToModel=function(a){a=c.pop();return p(a,g)};c.shiftToModel=function(a){a=
c.shift();return p(a,g)}}}else if(b.constructor===Object)for(e in c={},b)a=n(b[e],f,{name:e,parent:("[i]"===d.name?d.parent:d.name)+"."+e,full:d.full+"."+e}),a!==q&&(c[e]=a)}if(!j&&(l=h.extend))"function"===typeof l?c=l(c)||c:l.constructor===Object&&("function"===typeof l.map&&(c=l.map(c)||c),"function"===typeof l.unmap&&(c.___$unmapExtend=l.unmap));return c}function p(b,f){var d,a,c,e=r(b),g;g=b!==e;k&&k(f);if(!g&&b&&b.constructor===Function)return q;if(b&&b.___$unmapCustom)d=b.___$unmapCustom(b);
else if(g&&v(e)||m(e)||e.hasOwnProperty("___$appended"))d=e;else if(e instanceof Array){d=[];a=0;for(c=e.length;a<c;a++)d[a]=p(e[a],{name:"[i]",parent:f.name+"[i]",full:f.full+"[i]"})}else if(e.constructor===Object)for(a in d={},e){if("___$"!==a.substr(0,2)&&(g=e[a],!ko.isComputed(g)&&!((c=r(g))&&c.constructor===Function)))g=p(g,{name:a,parent:("[i]"===f.name?f.parent:f.name)+"."+a,full:f.full+"."+a}),g!==q&&(d[a]=g)}else!g&&"function"!==typeof e&&(d=e);b&&b.___$unmapExtend&&(d=b.___$unmapExtend(d,
b));return d}function s(b,f,d){var a,c,e,g,l,j,h=r(f);c=f!==h;k&&k(d);if(c&&m(h)^m(b))f(b);else if(b&&h&&h.constructor==Object&&b.constructor===Object)for(a in b)c=h[a],!m(c)&&f.hasOwnProperty("___$appended")?h[a]=b:c&&"function"===typeof c.___$mapCustom?z(c)?(e=c.___$mapCustom(b[a]),e=r(e),c(e)):h[a]=h[a].___$mapCustom(b[a]):m(b[a])&&h[a]&&h[a].constructor===Object?h[a]=b[a]:s(b[a],h[a],{name:a,parent:("[i]"===d.name?d.parentChildName:d.name)+"."+a,full:d.full+"."+a});else if(h&&h instanceof Array)if(j=
f.___$childIdName){g=[];for(a=b.length-1;0<=a;a--){e=!1;l=b[a][j];for(c=h.length-1;0<=c;c--)if(l===h[c][j]()){s(b[a],h[c],{name:"[i]",parentChildName:d.name+"[i]",full:d.full+"[i]"});e=!0;g[c]=!0;break}e||f.splice(a,1)}for(a=b.length-1;0<=a;a--)g[a]||f.pushFromModel(b[a])}else if(c=[],h=f.___$mapCustom,"function"===typeof h){a=0;for(d=b.length;a<d;a++)c[a]=b[a];f(h(c))}else{f(c);a=0;for(d=b?b.length:0;a<d;a++)f.pushFromModel(b[a])}else c&&f(b)}function t(b,f){w=b.makeChildArraysObservable;window.console&&
b.logging?(console.log(f),k=function(b,a,c){console.log("- "+(a&&a.settingType?a.settingType+" "+b.full+" (matched: '"+((c[b.full]?b.full:"")||(c[b.parent]?b.parent:"")||b.name)+"')":"default "+b.full))}):k=void 0}var r=ko.utils.unwrapObservable,z=ko.isObservable,x=ko.observable,y=ko.observableArray,u={name:"{root}",parent:"{root}",full:"{root}"},k,w,q=function(){};return{options:{makeChildArraysObservable:!0,logging:!1},fromModel:function(b,f){var d={},a=f?f.shared||{}:{},c,e,g,l,j,h,k;for(j in f)if(c=
f[j]||{},"shared"!==j)if(c instanceof Array){e=0;for(l=c.length;e<l;e++)g=c[e],d[g]=d[g]||{},d[g][j]=!0,d[g].settingType=d[g].settingType?"multiple":j}else if(c.constructor===Object)for(g in c){d[g]=d[g]||{};e=c[g];if((e="arrayChildId"!==j&&e&&e.constructor===String&&a[e]?a[e]:e)&&e.constructor===Object)for(h in e)if((k=e[h])&&k.constructor==String&&a[k])e[h]=a[k];d[g][j]=e;d[g].settingType=d[g].settingType?"multiple":j}t(this.options,"Mapping From Model");return n(b,d,u)},toModel:function(b){t(this.options,
"Mapping To Model");return p(b,u)},updateFromModel:function(b,f){t(this.options,"Update From Model");return s(f,b,u)}}}();